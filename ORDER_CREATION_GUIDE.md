# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∑–∞–∫–∞–∑–∞ CDEK

## –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

### 1. –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏:

1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≥–æ—Ä–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è
2. –£–∫–∞–∑–∞—Ç—å –ø–æ—á—Ç–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ñ–æ—Ä–º–∞—Ç: 6 —Ü–∏—Ñ—Ä)
3. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å—ã–ª–∫–∞—Ö (–≤–µ—Å, –≥–∞–±–∞—Ä–∏—Ç—ã)
4. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å"

–ü–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ —Å:
- –ù–∞–∑–≤–∞–Ω–∏–µ–º —Ç–∞—Ä–∏—Ñ–∞
- –°—Ç–æ–∏–º–æ—Å—Ç—å—é –¥–æ—Å—Ç–∞–≤–∫–∏
- –°—Ä–æ–∫–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (–º–∏–Ω-–º–∞–∫—Å –¥–Ω–∏)
- –î–∞—Ç–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)

### 2. –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–∞—Ä–∏—Ñ–∞ –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–í—ã–±—Ä–∞—Ç—å".

### 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å:

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- –¢–æ—Ä–≥–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è (–≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞)
- –°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏
- –ì–æ—Ä–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è (—Å –∫–æ–¥–∞–º–∏ CDEK)
- –ü–æ—á—Ç–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã (6 —Ü–∏—Ñ—Ä)
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:
  - –§–ò–û
  - –¢–µ–ª–µ—Ñ–æ–Ω (—Ñ–æ—Ä–º–∞—Ç: +79991234567 –∏–ª–∏ 79991234567)

**–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- –ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ (—É–ª–∏—Ü–∞, –¥–æ–º)
- –ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã
- –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ (–§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω)
- –û—Ü–µ–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑".

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞

–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ backend —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```typescript
{
  type: 1,                    // 1 - –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω, 2 - –¥–æ—Å—Ç–∞–≤–∫–∞
  number: "ORDER-...",        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
  tariff_code: 136,           // –ö–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞
  comment: "–ó–∞–∫–∞–∑ —á–µ—Ä–µ–∑...",  // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  
  recipient: {                // –ü–æ–ª—É—á–∞—Ç–µ–ª—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
    name: "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
    phones: [
      { number: "+79991234567" }
    ]
  },
  
  sender: {                   // –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    name: "–û–û–û –ö–æ–º–ø–∞–Ω–∏—è",
    phones: [
      { number: "+79991234567" }
    ]
  },
  
  from_location: {            // –ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    code: 270,                // –ö–æ–¥ –≥–æ—Ä–æ–¥–∞ CDEK
    country_code: "RU",
    city: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
    address: "—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1",
    postal_code: "630000"
  },
  
  to_location: {              // –ê–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è
    code: 44,                 // –ö–æ–¥ –≥–æ—Ä–æ–¥–∞ CDEK
    country_code: "RU",
    city: "–ú–æ—Å–∫–≤–∞",
    address: "—É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 10",
    postal_code: "101000"
  },
  
  packages: [                 // –°–ø–∏—Å–æ–∫ –ø–æ—Å—ã–ª–æ–∫
    {
      number: "1",
      weight: 1000,           // –í–µ—Å –≤ –≥—Ä–∞–º–º–∞—Ö
      length: 30,             // –î–ª–∏–Ω–∞ –≤ —Å–º
      width: 20,              // –®–∏—Ä–∏–Ω–∞ –≤ —Å–º
      height: 10,             // –í—ã—Å–æ—Ç–∞ –≤ —Å–º
      comment: "-",           // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –Ω–µ–ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
      items: [                // –¢–æ–≤–∞—Ä—ã –≤ –ø–æ—Å—ã–ª–∫–µ
        {
          name: "–¢–æ–≤–∞—Ä",
          ware_key: "ITEM-1",
          payment: { value: 5000 },
          cost: 5000,
          weight: 1000,
          amount: 1
        }
      ]
    }
  ]
}
```

## Backend –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –≠–Ω–¥–ø–æ–∏–Ω—Ç
`POST /cdek/orders`

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è DTO** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ `class-validator`
2. **–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - —É–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π –∏ null-–∑–Ω–∞—á–µ–Ω–∏–π
3. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ CDEK API** - POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `https://api.cdek.ru/v2/orders`
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:
   - –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ (`CdekOrder`)
   - –£–ø–∞–∫–æ–≤–∫–∏ (`CdekOrderPackage`)
   - –¢–æ–≤–∞—Ä—ã –≤ —É–ø–∞–∫–æ–≤–∫–∞—Ö (`CdekOrderItem`)
   - –ñ—É—Ä–Ω–∞–ª –∑–∞–ø—Ä–æ—Å–æ–≤ (`CdekOrderRequest`)
   - –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (`CdekOrderRelated`)

### –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

–ü—Ä–∏ —É—Å–ø–µ—Ö–µ:
```json
{
  "success": true,
  "data": {
    "entity": {
      "uuid": "12345678-1234-1234-1234-123456789012"
    },
    "requests": [...],
    "related_entities": [...],
    "local": {
      "orderId": 1,
      "uuid": "12345678-1234-1234-1234-123456789012",
      "cdekNumber": "1234567890"
    }
  },
  "message": "–ó–∞–∫–∞–∑ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"
}
```

–ü—Ä–∏ –æ—à–∏–±–∫–µ:
```json
{
  "success": false,
  "message": "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑",
  "error": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ü–æ–ª—è —Å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏

1. **comment –≤ packages** - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–ø—É—Å—Ç—ã–º (–º–∏–Ω–∏–º—É–º "-")
2. **–¢–µ–ª–µ—Ñ–æ–Ω—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å "+" –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
3. **postal_code** - —Å—Ç—Ä–æ–≥–æ 6 —Ü–∏—Ñ—Ä, –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –∏ –±—ç–∫–µ
4. **weight, length, width, height** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ Integer

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **"comment cannot be empty"** - –∑–∞–±—ã–ª–∏ —É–∫–∞–∑–∞—Ç—å comment –≤ packages
2. **"Invalid postal_code"** - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω–¥–µ–∫—Å–∞ (–Ω–µ 6 —Ü–∏—Ñ—Ä)
3. **"City code not found"** - –≥–æ—Ä–æ–¥ –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–∑ —Å–ø–∏—Å–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫
4. **"Tariff not selected"** - –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω —Ä–∞—Å—á—ë—Ç –∏–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ

### –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) -> Console
2. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞ –≤—ã–≤–µ–¥–µ—Ç—Å—è:
   - `üì¶ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ –≤ CDEK:` - —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
   - `‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:` - –æ—Ç–≤–µ—Ç –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
   - `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏

3. –ù–∞ backend –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç:
   - –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ CDEK API
   - –û—Ç–≤–µ—Ç –æ—Ç CDEK API
   - SQL –∑–∞–ø—Ä–æ—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ –∑–∞–∫–∞–∑—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL:

- `CdekOrder` - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ
- `CdekOrderPackage` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å—ã–ª–∫–∞—Ö
- `CdekOrderItem` - —Ç–æ–≤–∞—Ä—ã –≤ –ø–æ—Å—ã–ª–∫–∞—Ö
- `CdekOrderRequest` - –∂—É—Ä–Ω–∞–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- `CdekOrderRelated` - —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–≤–æ–∑–≤—Ä–∞—Ç—ã, –¥–æ–ø. —É—Å–ª—É–≥–∏)

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤:
```sql
SELECT * FROM "CdekOrder" ORDER BY "createdAt" DESC LIMIT 10;
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –º–æ–∂–Ω–æ:

1. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ: `GET /cdek/orders?cdek_number=1234567890`
2. –°–æ–∑–¥–∞—Ç—å –ø–µ—á–∞—Ç–Ω—É—é —Ñ–æ—Ä–º—É (–Ω–∞–∫–ª–∞–¥–Ω–∞—è/—à—Ç—Ä–∏—Ö–∫–æ–¥)
3. –û—Ç—Å–ª–µ–¥–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏
4. –°–æ–∑–¥–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–Ω—ã–π –∑–∞–∫–∞–∑ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
